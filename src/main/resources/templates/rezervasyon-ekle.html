<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Rezervasyon Oluştur</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
</head>
<body class="bg-light">
    <div class="container mt-5" style="max-width: 700px;">
        <div class="card shadow border-0">
            <div class="card-header bg-primary text-white fw-bold py-3">YENİ REZERVASYON KAYDI</div>
            <div class="card-body p-4">
                
                <form action="/rezervasyonlar/kaydet" method="POST" th:object="${yeniRez}">

                    <div th:if="${param.hata}" class="alert alert-danger text-center">
    Seçtiğiniz turda maalesef yeterli kontenjan kalmamıştır!
</div>
                    
                    <div class="mb-3">
                        <label class="form-label fw-bold">Rezervasyon No</label>
                        <input type="text" th:field="*{rezervasyonNo}" class="form-control bg-light" 
                               placeholder="Otomatik Oluşturulacak (Dokunmayınız)" readonly>
                    </div>

                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label class="form-label fw-bold">Müşteri Seç</label>
                            <select th:field="*{musteri}" class="form-select" required>
                                <option value="">Seçiniz...</option>
                                <option th:each="m : ${musteriler}" 
                                        th:value="${m.musteriId}" 
                                        th:text="${m.ad + ' ' + m.soyad}"></option>
                            </select>
                        </div>
                        
                        <div class="col-md-6">
                            <label class="form-label fw-bold">Tur Seç</label>
                            <select th:field="*{tur}" id="turSelect" class="form-select" onchange="tarihHesapla()" required>
                                <option value="" data-sure="0">Seçiniz...</option>
                                <option th:each="t : ${turlar}" 
                                        th:value="${t.turId}" 
                                        th:data-sure="${t.sureGun}" 
                                        th:text="${t.turAdi + ' (' + t.sureGun + ' Gün)'}"></option>
                            </select>
                        </div>
                    </div>

                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label class="form-label fw-bold">Başlangıç Tarihi</label>
                            <input type="date" th:field="*{baslangicTarihi}" id="baslangicTarihi" 
                                   class="form-control" onchange="tarihHesapla()" required>
                        </div>
                        
                        <div class="col-md-6">
                            <label class="form-label fw-bold text-success">Dönüş Tarihi (Otomatik)</label>
                            <input type="text" id="bitisTarihiGosterim" class="form-control bg-light fw-bold text-success" 
                                   placeholder="Tur seçilince hesaplanır" readonly>
                        </div>
                    </div>

                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label class="form-label fw-bold">Kişi Sayısı</label>
                            <input type="number" th:field="*{kisiSayisi}" class="form-control" value="1" required>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label fw-bold">Toplam Tutar</label>
                            <input type="number" step="0.01" th:field="*{toplamTutar}" class="form-control" placeholder="Otomatik hesaplanır">
                        </div>
                    </div>

                    <input type="hidden" name="durum" value="BEKLIYOR">

                    <button type="submit" class="btn btn-primary w-100 py-2 fw-bold">KAYDET VE OLUŞTUR</button>
                </form>
            </div>
        </div>
    </div>

    <script>
        function tarihHesapla() {
            // 1. Seçilen Turun Süresini Al
            var turSelect = document.getElementById("turSelect");
            var secilenOption = turSelect.options[turSelect.selectedIndex];
            var sureGun = parseInt(secilenOption.getAttribute("data-sure"));

            // 2. Seçilen Başlangıç Tarihini Al
            var baslangicInput = document.getElementById("baslangicTarihi").value;

            // Eğer ikisi de doluysa hesapla
            if (sureGun > 0 && baslangicInput) {
                var tarih = new Date(baslangicInput);
                
                // Gün ekle (Başlangıç + Süre)
                tarih.setDate(tarih.getDate() + sureGun);

                // Tarihi gg.aa.yyyy formatına çevir
                var gun = String(tarih.getDate()).padStart(2, '0');
                var ay = String(tarih.getMonth() + 1).padStart(2, '0'); // Aylar 0'dan başlar
                var yil = tarih.getFullYear();

                // Kutuyu doldur
                document.getElementById("bitisTarihiGosterim").value = gun + "." + ay + "." + yil;
            }
        }
    </script>

</body>
</html>